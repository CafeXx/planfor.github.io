<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>抽奖活动页面</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f9;
    }
    header {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      text-align: center;
    }
    main {
      padding: 20px;
    }
    h1, h2 {
      color: #333;
    }
    .section {
      margin-bottom: 20px;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .button {
      display: inline-block;
      padding: 10px 20px;
      margin: 10px 0;
      background-color: #4CAF50;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .button:hover:not(:disabled) {
      background-color: #45a049;
    }
    .info {
      margin-bottom: 20px;
      padding: 10px;
      background-color: #eaf5ea;
      border: 1px solid #4CAF50;
      border-radius: 8px;
    }
    .select-container {
      margin: 10px 0;
    }
    .progress-bar-container {
      margin-top: 20px;
      background-color: #ddd;
      border-radius: 20px;
      overflow: hidden;
      height: 25px;
    }
    .progress-bar {
      height: 100%;
      background-color: #4CAF50;
      width: 0%;
      text-align: center;
      color: white;
      line-height: 25px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <h1>抽奖活动页面</h1>
  </header>
  <main>
    <!-- 显示当前等级、活动币、剩余抽奖次数 -->
    <div class="info">
      <p><strong>当前等级：</strong><span id="current-level">Lv1</span></p>
      <p><strong>当前活动币：</strong><span id="current-coins">0</span></p>
      <p><strong>剩余抽奖次数：</strong><span id="current-lottery-times">0</span></p>
      <div class="progress-bar-container">
        <div id="progress-bar" class="progress-bar">0%</div>
      </div>
    </div>

    <!-- 操作功能 -->
    <div class="section">
      <h2>操作功能</h2>
      <div class="select-container">
        <label for="lottery-method">选择获取抽奖次数的途径：</label>
        <select id="lottery-method">
          <option value="学习25分钟任务">学习25分钟任务</option>
          <option value="学习45分钟任务">学习45分钟任务</option>
          <option value="健身/拉伸">健身/拉伸</option>
          <option value="完成Dead Aim">完成Dead Aim</option>
          <option value="连续3天完成Dead Aim">连续3天完成Dead Aim</option>
          <option value="连续5天完成Dead Aim">连续5天完成Dead Aim</option>
          <option value="阅读">阅读</option>
          <option value="体重下降0.5kg">体重下降0.5kg</option>
        </select>
      </div>
      <button class="button" onclick="addLotteryChance()">获取抽奖次数</button>
      <button class="button" id="draw-lottery-btn" onclick="drawLottery()" disabled>进行抽奖</button>
      <button class="button" onclick="exchangeCoins()">兑换活动币</button>
      <button class="button" onclick="viewRecords()">查看记录</button>
      <button class="button" onclick="resetData()">重置数据</button>
    </div>

    <!-- 抽奖规则 -->
    <div class="section">
      <h2>抽奖机会获得途径</h2>
      <ul>
        <li>一次学习（不包括阅读）25分钟任务获得1次抽奖机会</li>
        <li>一次学习（不包括阅读）45分钟任务获得2次抽奖机会</li>
        <li>一次健身/拉伸获得2次抽奖机会（每日限1次）</li>
        <li>每天完成Dead Aim获得额外1次抽奖机会</li>
        <li>连续3天完成Dead Aim获得额外3次抽奖机会</li>
        <li>连续5天完成Dead Aim获得额外5次抽奖机会</li>
        <li>每天完成阅读获得1次抽奖机会（每日限1次）</li>
        <li>体重每下降0.5kg获得1次抽奖机会</li>
      </ul>
    </div>

    <!-- 抽奖等级 -->
    <div class="section">
      <h2>抽奖等级与活动币规则</h2>
      <ul>
        <li><strong>Lv1：</strong>60%获得100币，25%获得200币，14%获得300币，1%获得1000币</li>
        <li><strong>Lv2：</strong>55%获得100币，29%获得200币，14%获得300币，2%获得1000币</li>
        <li><strong>Lv3：</strong>54%获得100币，29%获得200币，14%获得300币，2%获得1000币，1%获得3000币</li>
      </ul>
      <p>累计活动币升级规则：</p>
      <ul>
        <li>2000币升级Lv2</li>
        <li>10000币升级Lv3</li>
        <li>30000币升级Lv4</li>
      </ul>
    </div>

    <!-- 活动币兑换规则 -->
    <div class="section">
      <h2>活动币兑换规则</h2>
      <ul>
        <li>2000活动币：100元以内购物一次</li>
        <li>5000活动币：冰火楼/LR</li>
        <li>5000活动币：一晚上LOL</li>
        <li>5000活动币：随意外食一顿</li>
      </ul>
    </div>

    <!-- 记录显示 -->
    <div class="section" id="record-section" style="display: none;">
      <h2>记录</h2>
      <table>
        <thead>
          <tr>
            <th>日期</th>
            <th>时间</th>
            <th>当前等级</th>
            <th>事件</th>
            <th>活动币变化</th>
            <th>抽奖次数变化</th>
            <th>当前活动币</th>
            <th>当前抽奖次数</th>
          </tr>
        </thead>
        <tbody id="record-table">
          <!-- 动态生成记录 -->
        </tbody>
      </table>
    </div>
  </main>

  <script>
    // 初始化数据
    const initialData = {
      currentLevel: "Lv1",
      currentCoins: 0,
      currentLotteryTimes: 0,
      records: []
    };

    const data = JSON.parse(localStorage.getItem("lotteryData")) || initialData;

    // 更新页面显示
    function updateInfo() {
      document.getElementById("current-level").textContent = data.currentLevel;
      document.getElementById("current-coins").textContent = data.currentCoins;
      document.getElementById("current-lottery-times").textContent = data.currentLotteryTimes;
      document.getElementById("draw-lottery-btn").disabled = data.currentLotteryTimes === 0;

      const progress = Math.min((data.currentCoins / getNextLevelCoins()) * 100, 100);
      document.getElementById("progress-bar").style.width = `${progress}%`;
      document.getElementById("progress-bar").textContent = `${Math.round(progress)}%`;
    }

    // 获取下一级需要的活动币
    function getNextLevelCoins() {
      if (data.currentLevel === "Lv1") return 2000;
      if (data.currentLevel === "Lv2") return 10000;
      if (data.currentLevel === "Lv3") return 30000;
      return Infinity; // Lv4 没有下一等级
    }

    // 获取抽奖次数途径对应的奖励
    function getLotteryReward(method) {
      const rewards = {
        "学习25分钟任务": 1,
        "学习45分钟任务": 2,
        "健身/拉伸": 2,
        "完成Dead Aim": 1,
        "连续3天完成Dead Aim": 3,
        "连续5天完成Dead Aim": 5,
        "阅读": 1,
        "体重下降0.5kg": 1
      };
      return rewards[method] || 0;
    }

    // 获取抽奖次数
    function addLotteryChance() {
      const method = document.getElementById("lottery-method").value;
      const reward = getLotteryReward(method);
      data.currentLotteryTimes += reward;
      addRecord(`获取抽奖次数（${method}）`, 0, reward);
      saveData();
      updateInfo();
    }

    // 进行抽奖
    function drawLottery() {
      if (data.currentLotteryTimes === 0) return;

      const random = Math.random() * 100;
      let coinsWon = 0;

      if (data.currentLevel === "Lv1") {
        if (random <= 60) coinsWon = 100;
        else if (random <= 85) coinsWon = 200;
        else if (random <= 99) coinsWon = 300;
        else coinsWon = 1000;
      } else if (data.currentLevel === "Lv2") {
        if (random <= 55) coinsWon = 100;
        else if (random <= 84) coinsWon = 200;
        else if (random <= 98) coinsWon = 300;
        else coinsWon = 1000;
      } else if (data.currentLevel === "Lv3") {
        if (random <= 54) coinsWon = 100;
        else if (random <= 83) coinsWon = 200;
        else if (random <= 97) coinsWon = 300;
        else if (random <= 99) coinsWon = 1000;
        else coinsWon = 3000;
      }

      data.currentCoins += coinsWon;
      data.currentLotteryTimes--;
      alert(`抽奖成功！获得活动币：${coinsWon}`);
      addRecord("抽奖", coinsWon, -1);
      checkLevelUpgrade();
      saveData();
      updateInfo();
    }

    // 活动币兑换
    function exchangeCoins() {
      alert("兑换功能暂未实现！");
      addRecord("兑换活动币", 0, 0);
      saveData();
      updateInfo();
    }

    // 查看记录
    function viewRecords() {
      const recordSection = document.getElementById("record-section");
      recordSection.style.display = "block";
      const recordTable = document.getElementById("record-table");
      recordTable.innerHTML = data.records.map(record => `
        <tr>
          <td>${record.date}</td>
          <td>${record.time}</td>
          <td>${record.level}</td>
          <td>${record.event}</td>
          <td>${record.coinChange}</td>
          <td>${record.lotteryChange}</td>
          <td>${record.currentCoins}</td>
          <td>${record.currentLotteryTimes}</td>
        </tr>
      `).join("");
    }

    // 添加记录
    function addRecord(event, coinChange, lotteryChange) {
      const now = new Date();
      const date = now.toLocaleDateString();
      const time = now.toLocaleTimeString();
      data.records.push({
        date,
        time,
        level: data.currentLevel,
        event,
        coinChange,
        lotteryChange,
        currentCoins: data.currentCoins,
        currentLotteryTimes: data.currentLotteryTimes
      });
    }

    // 检查等级升级
    function checkLevelUpgrade() {
      if (data.currentCoins >= 30000) {
        data.currentLevel = "Lv4";
      } else if (data.currentCoins >= 10000) {
        data.currentLevel = "Lv3";
      } else if (data.currentCoins >= 2000) {
        data.currentLevel = "Lv2";
      } else {
        data.currentLevel = "Lv1";
      }
    }

    // 保存数据到 localStorage
    function saveData() {
      localStorage.setItem("lotteryData", JSON.stringify(data));
    }

    // 重置数据
    function resetData() {
      if (confirm("确定要重置所有数据吗？此操作不可恢复！")) {
        localStorage.removeItem("lotteryData");
        Object.assign(data, initialData);
        saveData();
        updateInfo();
        alert("数据已重置！");
      }
    }

    // 初始化页面信息
    updateInfo();
  </script>
</body>
</html>
